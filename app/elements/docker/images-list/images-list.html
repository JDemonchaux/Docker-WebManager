<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-styles/typography.html">

<dom-module id="images-list">
    <template>
        <style>
            :host {
                display: block;
            }

            span {
                @apply(--paper-font-body1);
            }
        </style>

        <iron-ajax url="[[apiUrl]]images/json?all=1" last-response="{{data}}" auto></iron-ajax>

        <paper-datatable data="{{data}}" selectable>
            <paper-datatable-column header="RepoTags" type="Object" property="RepoTags">
                <template>
                    <span>
                        <iron-list items="[[value]]" as="repo">
                            <template>
                                <span>{{repo}}</span>
                            </template>
                        </iron-list>
                    </span>
                </template>
            </paper-datatable-column>

            <paper-datatable-column header="Logo" type="String" property="RepoTags">
                <template>
                    <docker-logo name="{{value}}"></docker-logo>
                </template>
            </paper-datatable-column>

            <paper-datatable-column header="Created" property="Created" sortable>
                <template>
                    <span>{{toDate(value)}}</span>
                </template>
            </paper-datatable-column>
            <paper-datatable-column header="Action" property="Id" type="String">
                <template>
                    <a href$="{{baseUrl}}images/{{value}}" data-route="images" on-tap="ontap">
                        <paper-button raised>Details</paper-button>
                    </a>
                    <a>
                        <paper-icon-button icon="av:play-arrow" id="{{value}}" on-click="start"></paper-icon-button>
                    </a>
                </template>
            </paper-datatable-column>
        </paper-datatable>

    </template>

    <script>
        (function () {
            'use strict';
            Polymer({
                is: 'images-list',
                properties: {
                    apiUrl: String
                },

                // Converti timestamp to date
                toDate: function (value) {
                    var d = new Date(value * 1000);
                    return (d.getDate() + '/' + (d.getMonth() + 1) + '/' + d.getFullYear());
                },

                log: function (items) {
                    console.log(items);
                },
                ontap: function (e) {
                    var route = e.currentTarget.getAttribute('href');
                    page.redirect(route);
                    console.log(route);
                },

                _toArray: function (obj) {
                    return Object.keys(obj).map(function (key) {
                        return {
                            name: key,
                            value: obj[key]
                        };
                    });
                }
            });
        })();

    </script>
</dom-module>
