<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-styles/typography.html">

<dom-module id="containers-list">
    <template>

        <style is="custom_style">
            paper-toolbar.white {
                --paper-toolbar-background: white !important;
                color: black !important;
            }

            paper-icon-button {
                width: 45px;
                height: 45px;
            }

            a > paper-button {
                color:black !important;
            }

            a.link {
                text-decoration: none;
                color: rgba(0, 0, 0, .87) !important;
                /*@apply(--paper-button);*/
            }

            a.hidden {
                display: none;
            }

            table, th, td {
                border: none;
            }

            thead, tr {
                border-bottom: 1px solid #d0d0d0;
            }

            td, th {
                padding: 0px 5px;
                display: table-cell;
                text-align: left;
                vertical-align: middle;
                border-radius: 2px;
            }

        </style>

        <iron-ajax url="[[apiUrl]]containers/json?all=1" last-response="{{items}}" auto></iron-ajax>
        <!--<iron-ajax url="http://localhost/Docker-WebManager/containers-json.json"
                   last-response="{{items}}"
                   auto>
        </iron-ajax>-->
        <paper-toolbar class="white">
            <paper-button>
                <iron-icon icon="add"></iron-icon>
                Create
            </paper-button>
            <paper-button>
                <iron-icon icon="create"></iron-icon>
                Update
            </paper-button>
            <paper-button>
                <iron-icon icon="delete"></iron-icon>
                Delete
            </paper-button>
        </paper-toolbar>


        <paper-datatable data="{{items}}" selectable>
            <paper-datatable-column header="Status" property="Status">
                <template>
                    <containers-status status="{{value}}"></containers-status>
                </template>
            </paper-datatable-column>
            <paper-datatable-column header="Names" property="Names">
            </paper-datatable-column>
            <paper-datatable-column header="Image" property="Image">
                <template>
                    <span>{{value}}</span>
                </template>
            </paper-datatable-column>
            <paper-datatable-column header="Ports" type="Object" property="Ports">
                <template>
                    <table>
                        <thead>
                        <tr>
                            <th>IP</th>
                            <th>Public port</th>
                            <th>Private port</th>
                            <th>Type</th>
                        </tr>
                        </thead>
                        <tbody>
                        <template is="dom-repeat" items="{{value}}" as="port">
                            <tr>
                                <td>{{port.IP}}</td>
                                <td>{{port.PrivatePort}}</td>
                                <td>{{port.PublicPort}}</td>
                                <td>{{port.Type}}</td>
                            </tr>
                        </template>
                        </tbody>
                    </table>
                </template>
            </paper-datatable-column>
            <paper-datatable-column header="Created" property="Created" sortable>
                <template>
                    <span>{{toDate(value)}}</span>
                </template>
            </paper-datatable-column>
            <paper-datatable-column header="Action" property="Id" type="String">
                <template>
                    <a href$="{{baseUrl}}containers/{{value}}" data-route="images" on-tap="ontap">
                        <paper-button raised>Details</paper-button>
                    </a>
                    <a>
                        <paper-icon-button icon="av:play-arrow"></paper-icon-button>
                    </a>
                </template>
            </paper-datatable-column>
        </paper-datatable>

    </template>

    <script>
        (function () {
            'use strict';

//            template.containers = JSON.parse('[ { "Id": "8dfafdbc3a40", "Names":["/boring_feynman"], "Image": "ubuntu:latest", "ImageID": "d74508fb6632491cea586a1fd7d748dfc5274cd6fdfedee309ecdcbc2bf5cb82", "Command": "echo 1", "Created": 1367854155, "Status": "Exit 0", "Ports": [{"PrivatePort": 2222, "PublicPort": 3333, "Type": "tcp"}], "Labels": { "com.example.vendor": "Acme", "com.example.license": "GPL", "com.example.version": "1.0" }, "SizeRw": 12288, "SizeRootFs": 0 }, { "Id": "9cd87474be90", "Names":["/coolName"], "Image": "ubuntu:latest", "ImageID": "d74508fb6632491cea586a1fd7d748dfc5274cd6fdfedee309ecdcbc2bf5cb82", "Command": "echo 222222", "Created": 1367854155, "Status": "Exit 0", "Ports": [], "Labels": {}, "SizeRw": 12288, "SizeRootFs": 0 }, { "Id": "3176a2479c92", "Names":["/sleepy_dog"], "Image": "ubuntu:latest", "ImageID": "d74508fb6632491cea586a1fd7d748dfc5274cd6fdfedee309ecdcbc2bf5cb82", "Command": "echo 3333333333333333", "Created": 1367854154, "Status": "Exit 0", "Ports":[], "Labels": {}, "SizeRw":12288, "SizeRootFs":0 }, { "Id": "4cb07b47f9fb", "Names":["/running_cat"], "Image": "ubuntu:latest", "ImageID": "d74508fb6632491cea586a1fd7d748dfc5274cd6fdfedee309ecdcbc2bf5cb82", "Command": "echo 444444444444444444444444444444444", "Created": 1367854152, "Status": "Exit 0", "Ports": [], "Labels": {}, "SizeRw": 12288, "SizeRootFs": 0 } ]')

            Polymer({
                is: 'containers-list',

                properties: {
                    apiUrl: {
                        type: String,
                        notify: true
                    },
                    baseUrl: {
                        type: String,
                        notify: true
                    }
                },

                // Converti timestamp to date
                toDate: function (value) {
                    var d = new Date(value * 1000);
                    return (d.getDate() + '/' + (d.getMonth() + 1) + '/' + d.getFullYear());
                },
                ontap: function (e) {
                    var route = e.currentTarget.getAttribute('href');
                    page.redirect(route);
                    console.log(route);
                },

                isUp(status) {
                    if (status.indexOf("up") >= 0) {
                        console.log("up");
                        return isTrue;
                    }
                },

                isExit(status) {
                    if (status.indexOf("Exit") >= 0) {
                        console.log("down");
                        return isTrue;
                    }
                }
            });
        })();


    </script>

</dom-module>